<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Productos Guardados</title>
  <style>
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #999; padding: 6px; }
  </style>
</head>
<body>
  <h2>Lista de Productos</h2>
  <table id="tabla">
    <thead>
      <tr>
        <th>Nombre</th><th>Ingredientes</th><th>Senasa</th><th>EPA</th><th>Días</th>
        <th>Plagas</th><th>Máxima</th><th>Litro</th><th>Banda</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button onclick="window.print()">Imprimir</button>
  <button onclick="descargarExcel()">Descargar Excel</button>

  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDN0rsDAaXoZ9ERSQF2WdDB4IIevYAyp1k",
      authDomain: "agro-productos.firebaseapp.com",
      projectId: "agro-productos",
      storageBucket: "agro-productos.appspot.com",
      messagingSenderId: "196774282512",
      appId: "1:196774282512:web:92697209153eac8acb1195",
      databaseURL: "https://agro-productos-default-rtdb.firebaseio.com/"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const tablaBody = document.querySelector("tbody");
    db.ref("productos").on("value", (snapshot) => {
      tablaBody.innerHTML = "";
      snapshot.forEach((child) => {
        const d = child.val();
        const row = `<tr>
          <td>${d.nombre}</td><td>${d.ingredientes}</td><td>${d.senasa}</td>
          <td>${d.epa}</td><td>${d.dias}</td><td>${d.plagas}</td>
          <td>${d.maxima}</td><td>${d.litro}</td><td>${d.banda}</td>
        </tr>`;
        tablaBody.innerHTML += row;
      });
    });

    function descargarExcel() {
      const tabla = document.getElementById("tabla").outerHTML;
      const data = 'data:application/vnd.ms-excel,' + encodeURIComponent(tabla);
      const link = document.createElement('a');
      link.href = data;
      link.download = 'productos.xls';
      link.click();
    }
  </script>
</body>
</html>
