<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Cosecha Semanal</title>
    <style>
        :root {
            --primary-dark: #1b4332;
            --primary: #2d6a4f;
            --primary-light: #40916c;
            --accent: #74c69d;
            --light-bg: #f8f9fa;
            --text-dark: #212529;
            --text-light: #f8f9fa;
            --border: #dee2e6;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 15px;
            line-height: 1.6;
            background-color: #f5f7f9;
            color: var(--text-dark);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(to right, var(--primary-dark), var(--primary));
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .form-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .info-box {
            background-color: #e8f5e9;
            border-left: 4px solid var(--primary);
            padding: 12px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--primary-dark);
            font-size: 0.9rem;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 1rem;
        }
        
        input[readonly] {
            background-color: #f0f0f0;
        }
        
        .production-section {
            margin-top: 25px;
        }
        
        .section-title {
            font-size: 1.2rem;
            color: var(--primary-dark);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--accent);
        }
        
        .production-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .production-card {
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 15px;
            background-color: white;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .production-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
        }
        
        .invernadero-id {
            font-weight: bold;
            color: var(--primary-dark);
            font-size: 1.1rem;
        }
        
        .cultivo-type {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .cultivo-mini {
            background-color: #d8f3dc;
            color: #1b4332;
        }
        
        .cultivo-tomate {
            background-color: #ffe5d9;
            color: #9c4d25;
        }
        
        .cantidad-input {
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
            padding: 12px;
        }
        
        .cantidad-input::placeholder {
            color: #adb5bd;
            font-weight: normal;
        }
        
        .submit-btn {
            background-color: var(--primary-dark);
            color: white;
            padding: 14px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.1rem;
            width: 100%;
            margin-top: 25px;
            transition: background-color 0.3s;
            font-weight: bold;
        }
        
        .submit-btn:hover {
            background-color: var(--primary);
        }
        
        .message {
            padding: 12px;
            border-radius: 4px;
            margin-top: 20px;
            text-align: center;
            font-weight: bold;
        }
        
        .success {
            background-color: #d8f3dc;
            color: #1b4332;
            border: 1px solid #b7e4c7;
        }
        
        .error {
            background-color: #ffe5d9;
            color: #9c4d25;
            border: 1px solid #ffcfb6;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            color: #6c757d;
            font-size: 0.9rem;
            padding: 15px;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .production-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.5rem;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .form-container {
                padding: 15px;
            }
            
            .production-card {
                padding: 12px;
            }
        }
    </style>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Producción Semanal Unidad 1</h1>
            <p>Sistema de registro de cosecha</p>
        </header>
        
        <div class="form-container">
            <div class="info-box">
                <p><strong>Configuración de cultivos:</strong></p>
                <p>• Invernaderos 9, 10, 11, 12, 33, 35, 37, 39: Cultivo Mini</p>
                <p>• Invernaderos 13, 14, 15, 16: Cultivo Tomate</p>
            </div>
            
            <form id="cosechaForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="semana">Semana (actual):</label>
                        <input type="number" id="semana" name="semana" min="1" max="52" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="fecha">Fecha:</label>
                        <input type="date" id="fecha" name="fecha" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="dia">Día (automático):</label>
                        <input type="text" id="dia" name="dia" readonly>
                    </div>
                </div>
                
                <div class="production-section">
                    <h3 class="section-title">Registro de Producción</h3>
                    
                    <div class="production-grid">
                        <!-- Invernaderos Mini -->
                        <div class="production-card">
                            <div class="card-header">
                                <span class="invernadero-id">Invernadero 9</span>
                                <span class="cultivo-type cultivo-mini">Mini</span>
                            </div>
                            <input type="number" class="cantidad-input" name="cantidad_9_mini" min="0" step="0.1" placeholder="Ingrese kg" required>
                        </div>
                        
                        <div class="production-card">
                            <div class="card-header">
                                <span class="invernadero-id">Invernadero 10</span>
                                <span class="cultivo-type cultivo-mini">Mini</span>
                            </div>
                            <input type="number" class="cantidad-input" name="cantidad_10_mini" min="0" step="0.1" placeholder="Ingrese kg" required>
                        </div>
                        
                        <div class="production-card">
                            <div class="card-header">
                                <span class="invernadero-id">Invernadero 11</span>
                                <span class="cultivo-type cultivo-mini">Mini</span>
                            </div>
                            <input type="number" class="cantidad-input" name="cantidad_11_mini" min="0" step="0.1" placeholder="Ingrese kg" required>
                        </div>
                        
                        <div class="production-card">
                            <div class="card-header">
                                <span class="invernadero-id">Invernadero 12</span>
                                <span class="cultivo-type cultivo-mini">Mini</span>
                            </div>
                            <input type="number" class="cantidad-input" name="cantidad_12_mini" min="0" step="0.1" placeholder="Ingrese kg" required>
                        </div>
                        
                        <div class="production-card">
                            <div class="card-header">
                                <span class="invernadero-id">Invernadero 33</span>
                                <span class="cultivo-type cultivo-mini">Mini</span>
                            </div>
                            <input type="number" class="cantidad-input" name="cantidad_33_mini" min="0" step="0.1" placeholder="Ingrese kg" required>
                        </div>
                        
                        <div class="production-card">
                            <div class="card-header">
                                <span class="invernadero-id">Invernadero 35</span>
                                <span class="cultivo-type cultivo-mini">Mini</span>
                            </div>
                            <input type="number" class="cantidad-input" name="cantidad_35_mini" min="0" step="0.1" placeholder="Ingrese kg" required>
                        </div>
                        
                        <div class="production-card">
                            <div class="card-header">
                                <span class="invernadero-id">Invernadero 37</span>
                                <span class="cultivo-type cultivo-mini">Mini</span>
                            </div>
                            <input type="number" class="cantidad-input" name="cantidad_37_mini" min="0" step="0.1" placeholder="Ingrese kg" required>
                        </div>
                        
                        <div class="production-card">
                            <div class="card-header">
                                <span class="invernadero-id">Invernadero 39</span>
                                <span class="cultivo-type cultivo-mini">Mini</span>
                            </div>
                            <input type="number" class="cantidad-input" name="cantidad_39_mini" min="0" step="0.1" placeholder="Ingrese kg" required>
                        </div>
                        
                        <!-- Invernaderos Tomate -->
                        <div class="production-card">
                            <div class="card-header">
                                <span class="invernadero-id">Invernadero 13</span>
                                <span class="cultivo-type cultivo-tomate">Tomate</span>
                            </div>
                            <input type="number" class="cantidad-input" name="cantidad_13_tomate" min="0" step="0.1" placeholder="Ingrese kg" required>
                        </div>
                        
                        <div class="production-card">
                            <div class="card-header">
                                <span class="invernadero-id">Invernadero 14</span>
                                <span class="cultivo-type cultivo-tomate">Tomate</span>
                            </div>
                            <input type="number" class="cantidad-input" name="cantidad_14_tomate" min="0" step="0.1" placeholder="Ingrese kg" required>
                        </div>
                        
                        <div class="production-card">
                            <div class="card-header">
                                <span class="invernadero-id">Invernadero 15</span>
                                <span class="cultivo-type cultivo-tomate">Tomate</span>
                            </div>
                            <input type="number" class="cantidad-input" name="cantidad_15_tomate" min="0" step="0.1" placeholder="Ingrese kg" required>
                        </div>
                        
                        <div class="production-card">
                            <div class="card-header">
                                <span class="invernadero-id">Invernadero 16</span>
                                <span class="cultivo-type cultivo-tomate">Tomate</span>
                            </div>
                            <input type="number" class="cantidad-input" name="cantidad_16_tomate" min="0" step="0.1" placeholder="Ingrese kg" required>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="submit-btn">Guardar Registro</button>
                
                <div id="message" class="message"></div>
            </form>
        </div>
        
        <footer>
            <p>Sistema Agroalpha © 2025 | Unidad Producción 1</p>
            <p>Versión 2.4 - Campos vacíos por defecto</p>
        </footer>
    </div>

    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            databaseURL: "https://agro-productos-default-rtdb.firebaseio.com/"
        };
        
        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Función para obtener el nombre del día en español
        function obtenerDiaEnEspanol(fecha) {
            const dias = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];
            return dias[fecha.getDay()];
        }
        
        // Establecer semana actual del año y fecha actual
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const startDate = new Date(today.getFullYear(), 0, 1);
            const days = Math.floor((today - startDate) / (24 * 60 * 60 * 1000));
            const weekNumber = Math.ceil(days / 7);
            
            document.getElementById('semana').value = weekNumber;
            document.getElementById('fecha').valueAsDate = today;
            document.getElementById('dia').value = obtenerDiaEnEspanol(today);
            
            // Actualizar el día cuando cambia la fecha
            document.getElementById('fecha').addEventListener('change', function() {
                const fechaSeleccionada = new Date(this.value);
                document.getElementById('dia').value = obtenerDiaEnEspanol(fechaSeleccionada);
            });
            
            // Manejar envío del formulario
            document.getElementById('cosechaForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const messageDiv = document.getElementById('message');
                messageDiv.innerHTML = '';
                messageDiv.className = 'message';
                
                // Obtener datos del formulario
                const semana = document.getElementById('semana').value;
                const fecha = document.getElementById('fecha').value;
                const dia = document.getElementById('dia').value;
                
                // Obtener datos de producción
                const produccion = [];
                
                // Lista de invernaderos y sus cultivos
                const invernaderosMini = [9, 10, 11, 12, 33, 35, 37, 39];
                const invernaderosTomate = [13, 14, 15, 16];
                
                // Recopilar datos de los invernaderos Mini
                for (const invernadero of invernaderosMini) {
                    const cantidadInput = document.querySelector(`input[name="cantidad_${invernadero}_mini"]`);
                    
                    if (cantidadInput && cantidadInput.value !== "" && parseFloat(cantidadInput.value) >= 0) {
                        produccion.push({
                            invernadero: invernadero.toString(),
                            cultivo: "Mini",
                            cantidad: parseFloat(cantidadInput.value)
                        });
                    }
                }
                
                // Recopilar datos de los invernaderos Tomate
                for (const invernadero of invernaderosTomate) {
                    const cantidadInput = document.querySelector(`input[name="cantidad_${invernadero}_tomate"]`);
                    
                    if (cantidadInput && cantidadInput.value !== "" && parseFloat(cantidadInput.value) >= 0) {
                        produccion.push({
                            invernadero: invernadero.toString(),
                            cultivo: "Tomate",
                            cantidad: parseFloat(cantidadInput.value)
                        });
                    }
                }
                
                // Verificar que haya al menos un registro de producción
                if (produccion.length === 0) {
                    messageDiv.textContent = 'Error: Debe ingresar al menos una cantidad de producción';
                    messageDiv.className = 'message error';
                    return;
                }
                
                // Crear objeto de datos
                const registroData = {
                    semana: semana,
                    fecha: fecha,
                    dia: dia,
                    produccion: produccion,
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                };
                
                // Guardar en Firebase
                const registrosRef = database.ref('registro-de-cosecha-semanal');
                const nuevoRegistroRef = registrosRef.push();
                
                nuevoRegistroRef.set(registroData)
                    .then(() => {
                        messageDiv.textContent = 'Registro guardado correctamente en Firebase';
                        messageDiv.className = 'message success';
                        
                        // Limpiar solo los campos de cantidad
                        const cantidadInputs = document.querySelectorAll('.cantidad-input');
                        cantidadInputs.forEach(input => {
                            input.value = '';
                        });
                    })
                    .catch((error) => {
                        messageDiv.textContent = 'Error al guardar el registro: ' + error.message;
                        messageDiv.className = 'message error';
                    });
            });
        });
    </script>
</body>
</html>
