<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gestión Clasificación IRAC</title>
  <style>
    :root {
      --primary-color: #2e7d32;
      --primary-hover: #1b5e20;
      --light-bg: #f1fdf3;
      --light-border: #c8e6c9;
      --white: #ffffff;
      --shadow: rgba(0,0,0,0.1);
      --accent-color: #1565c0;
      --accent-hover: #0d47a1;
      --nervioso: #e3f2fd;
      --crecimiento: #fff8e1;
      --respiración: #e8f5e9;
      --digestivo: #fbe9e7;
      --desconocido: #f5f5f5;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: Arial, sans-serif;
      background: var(--light-bg);
      margin: 0;
      padding: 20px;
      color: #333;
      min-height: 100vh;
    }
    
    h2 {
      text-align: center;
      color: var(--primary-color);
      margin-top: 0;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 2px solid var(--primary-color);
    }
    
    .tab {
      padding: 12px 20px;
      cursor: pointer;
      background: #e8f5e9;
      margin-right: 5px;
      border-radius: 5px 5px 0 0;
      font-weight: bold;
    }
    
    .tab.active {
      background: var(--primary-color);
      color: white;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .fisiologia-selector {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }
    
    .fisiologia-btn {
      padding: 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      text-align: center;
      transition: all 0.3s;
      box-shadow: 0 2px 5px var(--shadow);
    }
    
    .fisiologia-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 8px var(--shadow);
    }
    
    .nervioso {
      background-color: var(--nervioso);
      color: var(--accent-color);
    }
    
    .crecimiento {
      background-color: var(--crecimiento);
      color: #f57c00;
    }
    
    .respiración {
      background-color: var(--respiración);
      color: var(--primary-color);
    }
    
    .digestivo {
      background-color: var(--digestivo);
      color: #d32f2f;
    }
    
    .desconocido {
      background-color: var(--desconocido);
      color: #616161;
    }
    
    .grupos-container {
      background: var(--white);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px var(--shadow);
      margin-bottom: 20px;
    }
    
    .grupo-title {
      color: var(--primary-color);
      border-bottom: 2px solid var(--light-border);
      padding-bottom: 10px;
      margin-top: 0;
    }
    
    .grupos-lista {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 15px;
    }
    
    .grupo-item {
      border: 1px solid var(--light-border);
      border-radius: 8px;
      padding: 15px;
      background: #f9f9f9;
    }
    
    .grupo-nombre {
      font-weight: bold;
      margin-bottom: 10px;
      color: var(--accent-color);
    }
    
    .subgrupos-lista {
      margin-top: 10px;
      padding-left: 20px;
    }
    
    .subgrupo-item {
      margin-bottom: 10px;
      padding: 8px;
      background: var(--white);
      border-radius: 5px;
      border-left: 3px solid var(--primary-color);
    }
    
    .subgrupo-nombre {
      font-weight: bold;
      color: var(--primary-color);
    }
    
    .sustancias-lista {
      margin-top: 5px;
      font-size: 14px;
      color: #666;
    }
    
    .form-container {
      background: var(--white);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px var(--shadow);
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: var(--primary-color);
    }
    
    select, input, textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--light-border);
      border-radius: 5px;
      font-size: 16px;
    }
    
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    button {
      background: var(--primary-color);
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }
    
    button:hover {
      background: var(--primary-hover);
    }
    
    .btn-agregar-subgrupo {
      background: var(--accent-color);
      margin-top: 10px;
    }
    
    .btn-agregar-subgrupo:hover {
      background: var(--accent-hover);
    }
    
    .subgrupo-input {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      align-items: center;
    }
    
    .eliminar-subgrupo {
      background: #f44336;
      color: white;
      border: none;
      border-radius: 3px;
      padding: 5px 10px;
      cursor: pointer;
    }
    
    .footer {
      text-align: center;
      padding: 15px;
      background-color: var(--primary-color);
      color: white;
      border-radius: 5px;
      margin-top: 20px;
    }
    
    .footer p {
      margin: 5px 0;
    }
    
    .success {
      color: green;
      text-align: center;
      margin-top: 15px;
      font-weight: bold;
    }
    
    .error {
      color: red;
      text-align: center;
      margin-top: 15px;
    }
    
    @media (max-width: 768px) {
      .fisiologia-selector {
        grid-template-columns: 1fr;
      }
      
      .grupos-lista {
        grid-template-columns: 1fr;
      }
      
      .tabs {
        flex-direction: column;
      }
      
      .tab {
        margin-bottom: 5px;
        border-radius: 5px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Gestión de Clasificación IRAC España</h2>
    
    <div class="tabs">
      <div class="tab active" data-tab="visualizar">Visualizar Clasificación</div>
      <div class="tab" data-tab="agregar">Agregar Grupo</div>
    </div>
    
    <div class="tab-content active" id="visualizar">
      <div class="fisiologia-selector">
        <button class="fisiologia-btn nervioso" data-fisiologia="nervioso">Nervioso y muscular</button>
        <button class="fisiologia-btn crecimiento" data-fisiologia="crecimiento">Crecimiento y desarrollo</button>
        <button class="fisiologia-btn respiración" data-fisiologia="respiración">Respiración</button>
        <button class="fisiologia-btn digestivo" data-fisiologia="digestivo">Digestivo</button>
        <button class="fisiologia-btn desconocido" data-fisiologia="desconocido">Desconocido o no específico</button>
      </div>
      
      <div id="nervioso-container" class="grupos-container">
        <h3 class="grupo-title">Sistema Nervioso y Muscular</h3>
        <div class="grupos-lista">
          <!-- Los grupos se cargarán aquí -->
        </div>
      </div>
      
      <div id="crecimiento-container" class="grupos-container">
        <h3 class="grupo-title">Crecimiento y Desarrollo</h3>
        <div class="grupos-lista">
          <!-- Los grupos se cargarán aquí -->
        </div>
      </div>
      
      <div id="respiración-container" class="grupos-container">
        <h3 class="grupo-title">Respiración</h3>
        <div class="grupos-lista">
          <!-- Los grupos se cargarán aquí -->
        </div>
      </div>
      
      <div id="digestivo-container" class="grupos-container">
        <h3 class="grupo-title">Digestivo</h3>
        <div class="grupos-lista">
          <!-- Los grupos se cargarán aquí -->
        </div>
      </div>
      
      <div id="desconocido-container" class="grupos-container">
        <h3 class="grupo-title">Desconocido o no específico</h3>
        <div class="grupos-lista">
          <!-- Los grupos se cargarán aquí -->
        </div>
      </div>
    </div>
    
    <div class="tab-content" id="agregar">
      <div class="form-container">
        <h3 class="grupo-title">Agregar Nuevo Grupo IRAC</h3>
        
        <form id="form-grupo">
          <div class="form-group">
            <label for="fisiologia">Fisiología:</label>
            <select id="fisiologia" required>
              <option value="">Seleccione una fisiología</option>
              <option value="nervioso">Nervioso y muscular</option>
              <option value="crecimiento">Crecimiento y desarrollo</option>
              <option value="respiración">Respiración</option>
              <option value="digestivo">Digestivo</option>
              <option value="desconocido">Desconocido o no específico</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="grupo">Grupo principal:</label>
            <input type="text" id="grupo" placeholder="Ej: 1. Inhibidores de la acetilcolinesterasa" required>
          </div>
          
          <div class="form-group">
            <label>Subgrupos:</label>
            <div id="subgrupos-container">
              <!-- Los subgrupos se agregarán aquí -->
            </div>
            <button type="button" class="btn-agregar-subgrupo" id="agregar-subgrupo">+ Agregar Subgrupo</button>
          </div>
          
          <button type="submit">Guardar Grupo</button>
          <div class="success" id="mensaje-exito"></div>
          <div class="error" id="mensaje-error"></div>
        </form>
      </div>
    </div>
    
    <div class="footer">
      <p>Sistema Agroalpha © 2025 | Clasificación IRAC</p>
      <p>Basado en la clasificación de Febrero 2024</p>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDN0rsDAaXoZ9ERSQF2WdDB4IIevYAyp1k",
      authDomain: "agro-productos.firebaseapp.com",
      databaseURL: "https://agro-productos-default-rtdb.firebaseio.com",
      projectId: "agro-productos",
      storageBucket: "agro-productos.appspot.com",
      messagingSenderId: "196774282512",
      appId: "1:196774282512:web:92697209153eac8acb1195"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Referencia a la base de datos
    const iracRef = db.ref("clasificacion-irac");

    // Variables globales
    let clasificacionIRAC = {
      nervioso: [],
      crecimiento: [],
      respiración: [],
      digestivo: [],
      desconocido: []
    };

    // Cargar datos al iniciar
    document.addEventListener('DOMContentLoaded', function() {
      // Cargar datos desde Firebase
      cargarDatosIRAC();
      
      // Event listeners para los botones de fisiología
      document.querySelectorAll('.fisiologia-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const fisiologia = this.getAttribute('data-fisiologia');
          mostrarFisiologia(fisiologia);
        });
      });
      
      // Event listener para tabs
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', function() {
          const tabId = this.getAttribute('data-tab');
          cambiarTab(tabId);
        });
      });
      
      // Event listener para agregar subgrupo
      document.getElementById('agregar-subgrupo').addEventListener('click', agregarSubgrupoInput);
      
      // Event listener para el formulario
      document.getElementById('form-grupo').addEventListener('submit', guardarGrupo);
    });

    // Función para cargar datos desde Firebase
    function cargarDatosIRAC() {
      iracRef.on("value", (snapshot) => {
        const data = snapshot.val();
        if (data) {
          // Inicializar todas las fisiologías
          clasificacionIRAC = {
            nervioso: data.nervioso || [],
            crecimiento: data.crecimiento || [],
            respiración: data.respiración || [],
            digestivo: data.digestivo || [],
            desconocido: data.desconocido || []
          };
          
          // Mostrar sistema nervioso por defecto
          mostrarFisiologia('nervioso');
        } else {
          // Datos por defecto si no hay nada en Firebase
          inicializarDatosPorDefecto();
        }
      });
    }

    // Función para inicializar datos por defecto
    function inicializarDatosPorDefecto() {
      clasificacionIRAC = {
        nervioso: [
          {
            grupo: "1. Inhibidores de la acetilcolinesterasa",
            subgrupos: [
              {
                nombre: "1A Carbamatos",
                sustancias: "Formetanato, pirimicarb"
              },
              {
                nombre: "1B Organofosforados",
                sustancias: "Fostiazato, metil-pirimifos"
              }
            ]
          },
          {
            grupo: "3. Moduladores del canal de sodio",
            subgrupos: [
              {
                nombre: "3A Piretroides Piretrinas",
                sustancias: "Cipermetrina, deltametrina, esfenvalerato, etofenprox, lambda-cihalotrina, tau-fluvalinato, teflutrina"
              },
              {
                nombre: "",
                sustancias: "Piretrinas"
              }
            ]
          }
        ],
        crecimiento: [],
        respiración: [],
        digestivo: [],
        desconocido: []
      };
      
      // Guardar datos por defecto en Firebase
      iracRef.set(clasificacionIRAC);
      
      // Mostrar sistema nervioso
      mostrarFisiologia('nervioso');
    }

    // Función para mostrar los grupos de una fisiología
    function mostrarFisiologia(fisiologia) {
      // Ocultar todos los contenedores primero
      document.querySelectorAll('.grupos-container').forEach(container => {
        container.style.display = 'none';
      });
      
      // Mostrar el contenedor seleccionado
      const container = document.getElementById(`${fisiologia}-container`);
      container.style.display = 'block';
      
      // Cargar los datos
      const grupos = clasificacionIRAC[fisiologia];
      const gruposLista = container.querySelector('.grupos-lista');
      
      gruposLista.innerHTML = '';
      
      if (grupos.length === 0) {
        gruposLista.innerHTML = '<p>No hay datos disponibles para esta fisiología.</p>';
        return;
      }
      
      grupos.forEach(grupo => {
        const grupoItem = document.createElement('div');
        grupoItem.className = 'grupo-item';
        
        let html = `<div class="grupo-nombre">${grupo.grupo}</div>`;
        
        if (grupo.subgrupos && grupo.subgrupos.length > 0) {
          html += '<div class="subgrupos-lista">';
          
          grupo.subgrupos.forEach(subgrupo => {
            html += `
              <div class="subgrupo-item">
                ${subgrupo.nombre ? `<div class="subgrupo-nombre">${subgrupo.nombre}</div>` : ''}
                <div class="sustancias-lista">${subgrupo.sustancias}</div>
              </div>
            `;
          });
          
          html += '</div>';
        }
        
        grupoItem.innerHTML = html;
        gruposLista.appendChild(grupoItem);
      });
    }

    // Función para cambiar de pestaña
    function cambiarTab(tabId) {
      // Desactivar todas las pestañas
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Ocultar todos los contenidos
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      // Activar la pestaña seleccionada
      document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');
      document.getElementById(tabId).classList.add('active');
    }

    // Función para agregar campo de subgrupo
    function agregarSubgrupoInput() {
      const container = document.getElementById('subgrupos-container');
      const div = document.createElement('div');
      div.className = 'subgrupo-input';
      div.innerHTML = `
        <input type="text" placeholder="Nombre del subgrupo" class="subgrupo-nombre">
        <textarea placeholder="Sustancias activas (separadas por comas)" class="subgrupo-sustancias"></textarea>
        <button type="button" class="eliminar-subgrupo">X</button>
      `;
      
      container.appendChild(div);
      
      // Event listener para eliminar subgrupo
      div.querySelector('.eliminar-subgrupo').addEventListener('click', function() {
        container.removeChild(div);
      });
    }

    // Función para guardar grupo en Firebase
    function guardarGrupo(e) {
      e.preventDefault();
      
      const fisiologia = document.getElementById('fisiologia').value;
      const grupo = document.getElementById('grupo').value;
      
      if (!fisiologia || !grupo) {
        mostrarMensaje("Por favor, complete todos los campos obligatorios", "error");
        return;
      }
      
      // Obtener subgrupos
      const subgruposInputs = document.querySelectorAll('.subgrupo-input');
      const subgrupos = [];
      
      subgruposInputs.forEach(input => {
        const nombre = input.querySelector('.subgrupo-nombre').value;
        const sustancias = input.querySelector('.subgrupo-sustancias').value;
        
        if (nombre || sustancias) {
          subgrupos.push({
            nombre: nombre,
            sustancias: sustancias
          });
        }
      });
      
      // Crear nuevo grupo
      const nuevoGrupo = {
        grupo: grupo,
        subgrupos: subgrupos
      };
      
      // Agregar a la clasificación
      if (!clasificacionIRAC[fisiologia]) {
        clasificacionIRAC[fisiologia] = [];
      }
      
      clasificacionIRAC[fisiologia].push(nuevoGrupo);
      
      // Guardar en Firebase
      iracRef.set(clasificacionIRAC, function(error) {
        if (error) {
          mostrarMensaje("Error al guardar el grupo", "error");
        } else {
          mostrarMensaje("Grupo guardado con éxito", "success");
          document.getElementById('form-grupo').reset();
          document.getElementById('subgrupos-container').innerHTML = '';
          
          // Mostrar la fisiología donde se agregó el grupo
          setTimeout(() => {
            cambiarTab('visualizar');
            mostrarFisiologia(fisiologia);
          }, 1500);
        }
      });
    }

    // Función para mostrar mensajes
    function mostrarMensaje(mensaje, tipo) {
      const exito = document.getElementById("mensaje-exito");
      const error = document.getElementById("mensaje-error");
      
      if (tipo === "success") {
        exito.textContent = mensaje;
        error.textContent = "";
      } else {
        error.textContent = mensaje;
        exito.textContent = "";
      }
      
      // Ocultar mensajes después de 3 segundos
      setTimeout(() => {
        exito.textContent = "";
        error.textContent = "";
      }, 3000);
    }
  </script>
</body>
</html>
