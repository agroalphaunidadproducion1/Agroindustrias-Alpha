<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notificaciones - Agroalpha</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #45a049;
            --admin-color: #2196F3;
            --sidebar-bg: #2c3e50;
            --sidebar-hover: #34495e;
            --sidebar-active: #3498db;
            --light-gray: #f5f5f5;
            --white: #ffffff;
            --dark-gray: #000000;
            --warning-color: #ff9800;
            --success-color: #4caf50;
            --error-color: #f44336;
            --info-color: #2196f3;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light-gray);
            color: var(--dark-gray);
            min-height: 100vh;
            transition: margin-left 0.3s;
        }
        
        /* Header con botón hamburguesa */
        .header {
            background-color: var(--white);
            padding: 15px 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-left {
            display: flex;
            align-items: center;
        }
        
        .menu-toggle {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--dark-gray);
            padding: 5px;
            border-radius: 4px;
            transition: background-color 0.3s;
            margin-right: 15px;
        }
        
        .menu-toggle:hover {
            background-color: rgba(0,0,0,0.05);
        }
        
        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .brand h1 {
            font-size: 20px;
            color: var(--dark-gray);
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .notification-badge {
            background-color: var(--error-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            position: absolute;
            top: -5px;
            right: -5px;
        }
        
        /* Sidebar */
        .sidebar {
            width: 280px;
            background-color: var(--sidebar-bg);
            color: white;
            height: 100vh;
            position: fixed;
            top: 0;
            left: -280px;
            padding: 20px 0;
            overflow-y: auto;
            transition: left 0.3s;
            z-index: 200;
        }
        
        .sidebar.active {
            left: 0;
        }
        
        .close-menu {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            position: absolute;
            top: 15px;
            right: 20px;
            cursor: pointer;
        }
        
        .logo {
            padding: 0 20px 20px;
            border-bottom: 1px solid #34495e;
            margin-bottom: 20px;
            margin-top: 10px;
        }
        
        .logo h1 {
            font-size: 24px;
            font-weight: 600;
            color: white;
        }
        
        .user-info {
            padding: 0 20px 20px;
            border-bottom: 1px solid #34495e;
            margin-bottom: 20px;
        }
        
        .user-info p {
            margin-bottom: 5px;
            font-size: 14px;
            color: white;
        }
        
        .role-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-top: 4px;
            background-color: var(--admin-color);
            color: white;
        }
        
        .nav-section {
            margin-bottom: 25px;
        }
        
        .nav-section h3 {
            font-size: 14px;
            text-transform: uppercase;
            padding: 0 20px;
            margin-bottom: 10px;
            color: #95a5a6;
        }
        
        .nav-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.3s;
            color: white;
            text-decoration: none;
        }
        
        .nav-item:hover {
            background-color: var(--sidebar-hover);
        }
        
        .nav-item.active {
            background-color: var(--sidebar-active);
        }
        
        .nav-item i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        /* Submenú para configuraciones */
        .submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background-color: rgba(0, 0, 0, 0.1);
        }
        
        .submenu.active {
            max-height: 300px;
        }
        
        .submenu-item {
            padding: 10px 20px 10px 50px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.3s;
            color: white;
            text-decoration: none;
            font-size: 14px;
        }
        
        .submenu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .submenu-item i {
            margin-right: 10px;
            width: 16px;
            text-align: center;
            font-size: 12px;
        }
        
        .nav-item.has-submenu {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-item.has-submenu::after {
            content: '\f107';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            transition: transform 0.3s;
        }
        
        .nav-item.has-submenu.active::after {
            transform: rotate(180deg);
        }
        
        /* Overlay para cerrar menú al hacer clic fuera */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 150;
            display: none;
        }
        
        .overlay.active {
            display: block;
        }
        
        /* Main Content - Notificaciones */
        .main-content {
            padding: 30px;
            min-height: calc(100vh - 70px);
            transition: margin-left 0.3s;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .page-title {
            color: var(--primary-color);
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .page-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        /* Filtros de Notificaciones */
        .filters {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filter-group label {
            font-size: 14px;
            font-weight: 600;
            color: #555;
        }
        
        .filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
            min-width: 150px;
        }
        
        /* Lista de Notificaciones */
        .notifications-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .notification-item {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            gap: 15px;
            transition: background-color 0.3s;
        }
        
        .notification-item:hover {
            background-color: #f9f9f9;
        }
        
        .notification-item.unread {
            background-color: #f0f8ff;
            border-left: 4px solid var(--primary-color);
        }
        
        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
        }
        
        .icon-warning { background-color: var(--warning-color); }
        .icon-success { background-color: var(--success-color); }
        .icon-error { background-color: var(--error-color); }
        .icon-info { background-color: var(--info-color); }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }
        
        .notification-message {
            color: #666;
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .notification-meta {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #999;
        }
        
        .notification-actions {
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }
        
        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #666;
            padding: 5px;
            border-radius: 3px;
            transition: all 0.3s;
        }
        
        .action-btn:hover {
            background-color: #f0f0f0;
            color: #333;
        }
        
        .mark-read {
            color: var(--primary-color);
        }
        
        .delete {
            color: var(--error-color);
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            color: #ddd;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                padding: 20px;
            }
            
            .page-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .page-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .notification-item {
                flex-direction: column;
                gap: 10px;
            }
            
            .notification-actions {
                align-self: flex-end;
            }
            
            .filters {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <!-- Overlay para cerrar menú -->
    <div class="overlay" id="overlay"></div>
    
    <!-- Header con botón hamburguesa -->
    <div class="header">
        <div class="header-left">
            <button class="menu-toggle" id="menuToggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="brand">
                <h1>Agroalpha</h1>
            </div>
        </div>
        
        <div class="header-actions">
            <div style="position: relative;">
                <i class="fas fa-bell" style="font-size: 20px; color: #666;"></i>
                <div class="notification-badge" id="notificationCount">3</div>
            </div>
        </div>
    </div>
    
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <button class="close-menu" id="closeMenu">
            <i class="fas fa-times"></i>
        </button>
        
        <div class="logo">
            <h1>Agroalpha</h1>
        </div>
        
        <div class="user-info">
            <p id="user-unit">Unidad de Producción Principal</p>
            <p id="user-name">Usuario del Sistema</p>
            <p id="user-role" class="role-badge">Administrador</p>
        </div>
        
        <div class="nav-section">
            <h3>Navegación Principal</h3>
            <a class="nav-item" href="dashboard.html">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>
            <a class="nav-item" href="reportes.html">
                <i class="fas fa-chart-bar"></i>
                <span>Reportes</span>
            </a>
            <a class="nav-item active" href="notificaciones.html">
                <i class="fas fa-bell"></i>
                <span>Notificaciones</span>
            </a>
        </div>
        
        <div class="nav-section">
            <h3>Configuraciones</h3>
            <div class="nav-item has-submenu" id="configMenu">
                <div>
                    <i class="fas fa-cog"></i>
                    <span>Configuraciones Básicas</span>
                </div>
            </div>
            <div class="submenu" id="configSubmenu">
                <a class="submenu-item" href="tema.html">
                    <i class="fas fa-palette"></i>
                    <span>Color del Tema</span>
                </a>
                <a class="submenu-item" href="notificaciones-config.html">
                    <i class="fas fa-bell"></i>
                    <span>Configurar Notificaciones</span>
                </a>
                <a class="submenu-item" href="idioma.html">
                    <i class="fas fa-language"></i>
                    <span>Idioma</span>
                </a>
                <a class="submenu-item" href="privacidad.html">
                    <i class="fas fa-shield-alt"></i>
                    <span>Privacidad</span>
                </a>
                <a class="submenu-item" href="backup.html">
                    <i class="fas fa-database"></i>
                    <span>Backup Automático</span>
                </a>
            </div>
            
            <a class="nav-item" href="perfil.html">
                <i class="fas fa-user-cog"></i>
                <span>Mi Perfil</span>
            </a>
        </div>
        
        <div class="nav-section">
            <h3>Sistema</h3>
            <a class="nav-item" href="ayuda.html">
                <i class="fas fa-question-circle"></i>
                <span>Ayuda</span>
            </a>
            <a class="nav-item" href="acerca.html">
                <i class="fas fa-info-circle"></i>
                <span>Acerca del Sistema</span>
            </a>
            <div class="nav-item" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Cerrar Sesión</span>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <div class="page-header">
            <h1 class="page-title">
                <i class="fas fa-bell"></i>
                Notificaciones del Sistema
            </h1>
            <div class="page-actions">
                <button class="btn btn-secondary" id="markAllRead">
                    <i class="fas fa-check-double"></i>
                    Marcar todas como leídas
                </button>
                <button class="btn btn-primary" id="clearAll">
                    <i class="fas fa-trash"></i>
                    Limpiar todas
                </button>
            </div>
        </div>
        
        <!-- Filtros -->
        <div class="filters">
            <div class="filter-group">
                <label for="filterType">Tipo de Notificación</label>
                <select class="filter-select" id="filterType">
                    <option value="all">Todas</option>
                    <option value="warning">Advertencias</option>
                    <option value="success">Éxito</option>
                    <option value="error">Errores</option>
                    <option value="info">Información</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="filterStatus">Estado</label>
                <select class="filter-select" id="filterStatus">
                    <option value="all">Todas</option>
                    <option value="unread">No leídas</option>
                    <option value="read">Leídas</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="filterDate">Fecha</label>
                <select class="filter-select" id="filterDate">
                    <option value="all">Todas las fechas</option>
                    <option value="today">Hoy</option>
                    <option value="week">Esta semana</option>
                    <option value="month">Este mes</option>
                </select>
            </div>
        </div>
        
        <!-- Lista de Notificaciones -->
        <div class="notifications-container" id="notificationsList">
            <!-- Las notificaciones se cargarán aquí dinámicamente -->
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>

    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            databaseURL: "https://agro-productos-default-rtdb.firebaseio.com/"
        };
        
        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Referencias a Firebase
        const activeUsersRef = database.ref('uactivos');
        const notificationsRef = database.ref('notificaciones');
        
        // Elementos del DOM
        const menuToggle = document.getElementById('menuToggle');
        const closeMenu = document.getElementById('closeMenu');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const configMenu = document.getElementById('configMenu');
        const configSubmenu = document.getElementById('configSubmenu');
        const notificationsList = document.getElementById('notificationsList');
        const notificationCount = document.getElementById('notificationCount');
        const markAllReadBtn = document.getElementById('markAllRead');
        const clearAllBtn = document.getElementById('clearAll');
        const filterType = document.getElementById('filterType');
        const filterStatus = document.getElementById('filterStatus');
        const filterDate = document.getElementById('filterDate');
        
        // Variables globales
        let allNotifications = [];
        let currentUser = null;
        
        // Funciones para el menú hamburguesa
        function openMenu() {
            sidebar.classList.add('active');
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeSidebar() {
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
            document.body.style.overflow = 'auto';
        }
        
        // Función para alternar submenús
        function toggleSubmenu(menuItem, submenu) {
            menuItem.classList.toggle('active');
            submenu.classList.toggle('active');
        }
        
        // Event listeners para el menú
        menuToggle.addEventListener('click', openMenu);
        closeMenu.addEventListener('click', closeSidebar);
        overlay.addEventListener('click', closeSidebar);
        
        // Event listener para el submenú de configuración
        configMenu.addEventListener('click', function(e) {
            e.preventDefault();
            toggleSubmenu(this, configSubmenu);
        });
        
        // Verificar sesión al cargar
        document.addEventListener('DOMContentLoaded', function() {
            const userData = JSON.parse(sessionStorage.getItem('currentUser'));
            
            if (!userData || !userData.username) {
                window.location.href = '../index.html';
                return;
            }
            
            currentUser = userData;
            
            // Mostrar información del usuario
            displayUserInfo(userData);
            
            // Configurar evento de cierre de sesión
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // Cargar notificaciones
            loadNotifications();
            
            // Configurar eventos de los botones
            markAllReadBtn.addEventListener('click', markAllAsRead);
            clearAllBtn.addEventListener('click', clearAllNotifications);
            
            // Configurar eventos de filtros
            filterType.addEventListener('change', applyFilters);
            filterStatus.addEventListener('change', applyFilters);
            filterDate.addEventListener('change', applyFilters);
            
            // Verificar si el usuario sigue activo en uactivos
            activeUsersRef.child(userData.username).once('value')
                .then(snapshot => {
                    if (!snapshot.exists()) {
                        logout();
                        return;
                    }
                })
                .catch(error => {
                    console.error('Error verificando sesión activa:', error);
                });
        });
        
        // Mostrar información del usuario
        function displayUserInfo(userData) {
            document.getElementById('user-name').textContent = userData.name || userData.username;
            document.getElementById('user-unit').textContent = userData.unit || 'Unidad de Producción Principal';
            document.getElementById('user-role').textContent = userData.role || 'Usuario';
        }
        
        // Cargar notificaciones
        function loadNotifications() {
            // En un sistema real, aquí cargarías las notificaciones desde Firebase
            // Por ahora usamos datos de ejemplo
            allNotifications = [
                {
                    id: 1,
                    type: 'warning',
                    title: 'Stock Bajo',
                    message: 'El producto "Fertilizante NPK" tiene stock bajo. Quedan 15 unidades.',
                    timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000), // 2 horas atrás
                    read: false,
                    category: 'inventario'
                },
                {
                    id: 2,
                    type: 'success',
                    title: 'Proceso Completado',
                    message: 'El reporte de producción del mes ha sido generado exitosamente.',
                    timestamp: new Date(Date.now() - 5 * 60 * 60 * 1000), // 5 horas atrás
                    read: true,
                    category: 'reportes'
                },
                {
                    id: 3,
                    type: 'error',
                    title: 'Error en Sistema',
                    message: 'Se detectó un problema en el módulo de riego. Verificar conexiones.',
                    timestamp: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000), // 1 día atrás
                    read: false,
                    category: 'sistema'
                },
                {
                    id: 4,
                    type: 'info',
                    title: 'Nueva Actualización',
                    message: 'El sistema ha sido actualizado a la versión 2.1.0. Revisa las novedades.',
                    timestamp: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000), // 2 días atrás
                    read: true,
                    category: 'sistema'
                },
                {
                    id: 5,
                    type: 'warning',
                    title: 'Recordatorio',
                    message: 'Recordatorio: Revisión de equipos programada para mañana.',
                    timestamp: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000), // 3 días atrás
                    read: false,
                    category: 'mantenimiento'
                }
            ];
            
            applyFilters();
            updateNotificationCount();
        }
        
        // Aplicar filtros
        function applyFilters() {
            const typeFilter = filterType.value;
            const statusFilter = filterStatus.value;
            const dateFilter = filterDate.value;
            
            let filteredNotifications = [...allNotifications];
            
            // Filtrar por tipo
            if (typeFilter !== 'all') {
                filteredNotifications = filteredNotifications.filter(notif => notif.type === typeFilter);
            }
            
            // Filtrar por estado
            if (statusFilter !== 'all') {
                const isRead = statusFilter === 'read';
                filteredNotifications = filteredNotifications.filter(notif => notif.read === isRead);
            }
            
            // Filtrar por fecha
            if (dateFilter !== 'all') {
                const now = new Date();
                let startDate;
                
                switch(dateFilter) {
                    case 'today':
                        startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                        break;
                    case 'week':
                        startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                        break;
                    case 'month':
                        startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                        break;
                }
                
                filteredNotifications = filteredNotifications.filter(notif => notif.timestamp >= startDate);
            }
            
            displayNotifications(filteredNotifications);
        }
        
        // Mostrar notificaciones en la lista
        function displayNotifications(notifications) {
            if (notifications.length === 0) {
                notificationsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bell-slash"></i>
                        <h3>No hay notificaciones</h3>
                        <p>No se encontraron notificaciones con los filtros aplicados.</p>
                    </div>
                `;
                return;
            }
            
            notificationsList.innerHTML = notifications.map(notif => `
                <div class="notification-item ${notif.read ? '' : 'unread'}" data-id="${notif.id}">
                    <div class="notification-icon icon-${notif.type}">
                        <i class="fas ${getNotificationIcon(notif.type)}"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">${notif.title}</div>
                        <div class="notification-message">${notif.message}</div>
                        <div class="notification-meta">
                            <span><i class="fas fa-tag"></i> ${notif.category}</span>
                            <span><i class="fas fa-clock"></i> ${formatTimeAgo(notif.timestamp)}</span>
                        </div>
                    </div>
                    <div class="notification-actions">
                        ${!notif.read ? `
                            <button class="action-btn mark-read" onclick="markAsRead(${notif.id})" title="Marcar como leída">
                                <i class="fas fa-check"></i>
                            </button>
                        ` : ''}
                        <button class="action-btn delete" onclick="deleteNotification(${notif.id})" title="Eliminar">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        // Obtener icono según el tipo de notificación
        function getNotificationIcon(type) {
            const icons = {
                'warning': 'fa-exclamation-triangle',
                'success': 'fa-check-circle',
                'error': 'fa-exclamation-circle',
                'info': 'fa-info-circle'
            };
            return icons[type] || 'fa-bell';
        }
        
        // Formatear tiempo relativo
        function formatTimeAgo(timestamp) {
            const now = new Date();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 1) return 'Hace un momento';
            if (minutes < 60) return `Hace ${minutes} minuto${minutes > 1 ? 's' : ''}`;
            if (hours < 24) return `Hace ${hours} hora${hours > 1 ? 's' : ''}`;
            if (days < 7) return `Hace ${days} día${days > 1 ? 's' : ''}`;
            
            return timestamp.toLocaleDateString();
        }
        
        // Actualizar contador de notificaciones
        function updateNotificationCount() {
            const unreadCount = allNotifications.filter(notif => !notif.read).length;
            notificationCount.textContent = unreadCount;
            notificationCount.style.display = unreadCount > 0 ? 'flex' : 'none';
        }
        
        // Marcar notificación como leída
        function markAsRead(notificationId) {
            const notification = allNotifications.find(notif => notif.id === notificationId);
            if (notification) {
                notification.read = true;
                applyFilters();
                updateNotificationCount();
                
                // En un sistema real, actualizarías en Firebase
                console.log(`Notificación ${notificationId} marcada como leída`);
            }
        }
        
        // Marcar todas como leídas
        function markAllAsRead() {
            allNotifications.forEach(notif => {
                notif.read = true;
            });
            applyFilters();
            updateNotificationCount();
            
            // En un sistema real, actualizarías en Firebase
            console.log('Todas las notificaciones marcadas como leídas');
        }
        
        // Eliminar notificación
        function deleteNotification(notificationId) {
            if (confirm('¿Estás seguro de que quieres eliminar esta notificación?')) {
                allNotifications = allNotifications.filter(notif => notif.id !== notificationId);
                applyFilters();
                updateNotificationCount();
                
                // En un sistema real, eliminarías de Firebase
                console.log(`Notificación ${notificationId} eliminada`);
            }
        }
        
        // Limpiar todas las notificaciones
        function clearAllNotifications() {
            if (confirm('¿Estás seguro de que quieres eliminar todas las notificaciones?')) {
                allNotifications = [];
                applyFilters();
                updateNotificationCount();
                
                // En un sistema real, eliminarías todas de Firebase
                console.log('Todas las notificaciones eliminadas');
            }
        }
        
        // Cerrar sesión (función copiada del dashboard)
        function logout() {
            if (currentUser?.username) {
                // Eliminar de usuarios activos
                activeUsersRef.child(currentUser.username).remove()
                    .then(() => {
                        sessionStorage.removeItem('currentUser');
                        window.location.href = '../index.html';
                    })
                    .catch(error => {
                        console.error('Error al cerrar sesión:', error);
                        sessionStorage.removeItem('currentUser');
                        window.location.href = '../index.html';
                    });
            } else {
                sessionStorage.removeItem('currentUser');
                window.location.href = '../index.html';
            }
        }
    </script>
    <script src="js/theme-manager.js"></script>
</body>
</html>