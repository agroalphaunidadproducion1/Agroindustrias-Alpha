<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Editar Evaluaciones de Organismos BenÃ©ficos</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <style>
    :root {
      --primary-color: #2e7d32;
      --primary-hover: #1b5e20;
      --light-bg: #f1f8e9;
      --light-border: #c8e6c9;
      --white: #ffffff;
      --shadow: rgba(0,128,0,0.2);
      --danger: #f44336;
      --warning: #ff9800;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: Arial, sans-serif;
      background-color: var(--light-bg);
      padding: 20px;
      margin: 0;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    h1, h2 {
      text-align: center;
      color: var(--primary-color);
    }
    
    .search-section {
      background-color: var(--white);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px var(--shadow);
      margin-bottom: 20px;
    }
    
    .search-form {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      align-items: flex-end;
    }
    
    .search-group {
      flex: 1;
      min-width: 200px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: var(--primary-color);
    }
    
    input, select {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--light-border);
      border-radius: 5px;
      background-color: #f9fff9;
    }
    
    button {
      padding: 10px 15px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    
    button:hover {
      background-color: var(--primary-hover);
    }
    
    .btn-danger {
      background-color: var(--danger);
    }
    
    .btn-danger:hover {
      background-color: #d32f2f;
    }
    
    .btn-warning {
      background-color: var(--warning);
    }
    
    .btn-warning:hover {
      background-color: #f57c00;
    }
    
    .results-section {
      background-color: var(--white);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px var(--shadow);
      margin-bottom: 20px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid var(--light-border);
    }
    
    th {
      background-color: var(--light-bg);
      color: var(--primary-color);
    }
    
    tr:hover {
      background-color: #e8f5e9;
    }
    
    .action-buttons {
      display: flex;
      gap: 5px;
    }
    
    .edit-form {
      background-color: var(--white);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px var(--shadow);
      margin-bottom: 20px;
      display: none;
    }
    
    .form-section {
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--light-border);
    }
    
    .section-title {
      font-weight: bold;
      color: var(--primary-color);
      margin-bottom: 15px;
      font-size: 18px;
      padding-bottom: 5px;
      border-bottom: 2px solid var(--light-border);
    }
    
    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .form-group {
      flex: 1;
      min-width: 200px;
    }
    
    .checkbox-group {
      margin-top: 10px;
    }
    
    .checkbox-option {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      padding: 8px;
      border-radius: 5px;
      background-color: #f9fff9;
      border: 1px solid var(--light-border);
      cursor: pointer;
    }
    
    .checkbox-option input[type="radio"] {
      margin-right: 10px;
    }
    
    .checkbox-option:hover {
      background-color: #e8f5e9;
    }
    
    .footer {
      text-align: center;
      padding: 15px;
      background-color: var(--primary-color);
      color: white;
      border-radius: 5px;
      margin-top: 20px;
    }
    
    @media (max-width: 768px) {
      .form-row, .search-form {
        flex-direction: column;
        gap: 10px;
      }
      
      .form-group, .search-group {
        min-width: 100%;
      }
      
      .action-buttons {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸŒ¾ Editar Evaluaciones de Organismos BenÃ©ficos</h1>
    
    <!-- BÃºsqueda de registros -->
    <div class="search-section">
      <h2>Buscar Registros</h2>
      <div class="search-form">
        <div class="search-group">
          <label for="search-product">Nombre del producto:</label>
          <input type="text" id="search-product" placeholder="Ej: Insecticida X">
        </div>
        
        <div class="search-group">
          <label for="search-ingredient">Ingrediente activo:</label>
          <input type="text" id="search-ingredient" placeholder="Ej: Abamectina">
        </div>
        
        <div class="search-group">
          <label for="search-category">CategorÃ­a:</label>
          <select id="search-category">
            <option value="">Todas las categorÃ­as</option>
            <option value="Fungicida">Fungicida</option>
            <option value="Insecticida">Insecticida</option>
            <option value="Herbicida">Herbicida</option>
            <option value="Acaricida">Acaricida</option>
            <option value="Bactericida">Bactericida</option>
            <option value="Otro">Otro</option>
          </select>
        </div>
        
        <div class="search-group">
          <button id="search-button">Buscar</button>
        </div>
      </div>
    </div>
    
    <!-- Resultados de bÃºsqueda -->
    <div class="results-section">
      <h2>Resultados</h2>
      <div id="search-results">
        <p>Realice una bÃºsqueda para ver los registros.</p>
      </div>
    </div>
    
    <!-- Formulario de ediciÃ³n (inicialmente oculto) -->
    <div class="edit-form" id="edit-form">
      <h2>Editar EvaluaciÃ³n</h2>
      <form id="edit-form-daÃ±o">
        <input type="hidden" id="edit-key">
        
        <!-- InformaciÃ³n bÃ¡sica del producto -->
        <div class="form-section">
          <div class="section-title">InformaciÃ³n del Producto</div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="edit-categoria">CategorÃ­a del producto:</label>
              <select id="edit-categoria" required>
                <option value="">Seleccione una categorÃ­a</option>
                <option value="Fungicida">Fungicida</option>
                <option value="Insecticida">Insecticida</option>
                <option value="Herbicida">Herbicida</option>
                <option value="Acaricida">Acaricida</option>
                <option value="Bactericida">Bactericida</option>
                <option value="Otro">Otro</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="edit-producto">Nombre del producto:</label>
              <input type="text" id="edit-producto" required>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="edit-ingrediente">Ingrediente activo:</label>
              <input type="text" id="edit-ingrediente" required>
            </div>
          </div>
        </div>

        <!-- A. Swirskii -->
        <div class="form-section">
          <div class="section-title">A. Swirskii</div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="edit-swirskii_larva">Larva:</label>
              <select id="edit-swirskii_larva">
                <option value="0">Sin efecto</option>
                <option value="1">ğŸŸ¢ Nivel 1 â€“ &lt; 25%</option>
                <option value="2">ğŸŸ¡ Nivel 2 â€“ 25%-50%</option>
                <option value="3">ğŸŸ  Nivel 3 â€“ 50%-75%</option>
                <option value="4">ğŸ”´ Nivel 4 â€“ &gt; 75%</option>
                <option value="?">âšª Desconocido</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="edit-swirskii_adulto">Adulto:</label>
              <select id="edit-swirskii_adulto">
                <option value="0">Sin efecto</option>
                <option value="1">ğŸŸ¢ Nivel 1 â€“ &lt; 25%</option>
                <option value="2">ğŸŸ¡ Nivel 2 â€“ 25%-50%</option>
                <option value="3">ğŸŸ  Nivel 3 â€“ 50%-75%</option>
                <option value="4">ğŸ”´ Nivel 4 â€“ &gt; 75%</option>
                <option value="?">âšª Desconocido</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="edit-swirskii_huevo">Huevo:</label>
              <select id="edit-swirskii_huevo">
                <option value="0">Sin efecto</option>
                <option value="1">ğŸŸ¢ Nivel 1 â€“ &lt; 25%</option>
                <option value="2">ğŸŸ¡ Nivel 2 â€“ 25%-50%</option>
                <option value="3">ğŸŸ  Nivel 3 â€“ 50%-75%</option>
                <option value="4">ğŸ”´ Nivel 4 â€“ &gt; 75%</option>
                <option value="?">âšª Desconocido</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="edit-swirskii_ninfa">Ninfa:</label>
              <select id="edit-swirskii_ninfa">
                <option value="0">Sin efecto</option>
                <option value="1">ğŸŸ¢ Nivel 1 â€“ &lt; 25%</option>
                <option value="2">ğŸŸ¡ Nivel 2 â€“ 25%-50%</option>
                <option value="3">ğŸŸ  Nivel 3 â€“ 50%-75%</option>
                <option value="4">ğŸ”´ Nivel 4 â€“ &gt; 75%</option>
                <option value="?">âšª Desconocido</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="edit-swirskii_persistencia">Persistencia (dÃ­as):</label>
              <input type="text" id="edit-swirskii_persistencia" placeholder="Ej: 3-5 dÃ­as">
            </div>
          </div>
        </div>

        <!-- N. Cucumeris -->
        <div class="form-section">
          <div class="section-title">N. Cucumeris</div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="edit-cucumeris_larva">Larva:</label>
              <select id="edit-cucumeris_larva">
                <option value="0">Sin efecto</option>
                <option value="1">ğŸŸ¢ Nivel 1 â€“ &lt; 25%</option>
                <option value="2">ğŸŸ¡ Nivel 2 â€“ 25%-50%</option>
                <option value="3">ğŸŸ  Nivel 3 â€“ 50%-75%</option>
                <option value="4">ğŸ”´ Nivel 4 â€“ &gt; 75%</option>
                <option value="?">âšª Desconocido</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="edit-cucumeris_adulto">Adulto:</label>
              <select id="edit-cucumeris_adulto">
                <option value="0">Sin efecto</option>
                <option value="1">ğŸŸ¢ Nivel 1 â€“ &lt; 25%</option>
                <option value="2">ğŸŸ¡ Nivel 2 â€“ 25%-50%</option>
                <option value="3">ğŸŸ  Nivel 3 â€“ 50%-75%</option>
                <option value="4">ğŸ”´ Nivel 4 â€“ &gt; 75%</option>
                <option value="?">âšª Desconocido</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="edit-cucumeris_huevo">Huevo:</label>
              <select id="edit-cucumeris_huevo">
                <option value="0">Sin efecto</option>
                <option value="1">ğŸŸ¢ Nivel 1 â€“ &lt; 25%</option>
                <option value="2">ğŸŸ¡ Nivel 2 â€“ 25%-50%</option>
                <option value="3">ğŸŸ  Nivel 3 â€“ 50%-75%</option>
                <option value="4">ğŸ”´ Nivel 4 â€“ &gt; 75%</option>
                <option value="?">âšª Desconocido</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="edit-cucumeris_ninfa">Ninfa:</label>
              <select id="edit-cucumeris_ninfa">
                <option value="0">Sin efecto</option>
                <option value="1">ğŸŸ¢ Nivel 1 â€“ &lt; 25%</option>
                <option value="2">ğŸŸ¡ Nivel 2 â€“ 25%-50%</option>
                <option value="3">ğŸŸ  Nivel 3 â€“ 50%-75%</option>
                <option value="4">ğŸ”´ Nivel 4 â€“ &gt; 75%</option>
                <option value="?">âšª Desconocido</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="edit-cucumeris_persistencia">Persistencia (dÃ­as):</label>
              <input type="text" id="edit-cucumeris_persistencia" placeholder="Ej: 3-5 dÃ­as">
            </div>
          </div>
        </div>

        <!-- Crizopa -->
        <div class="form-section">
          <div class="section-title">Crizopa</div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="edit-crizopa_larva">Larva:</label>
              <select id="edit-crizopa_larva">
                <option value="0">Sin efecto</option>
                <option value="1">ğŸŸ¢ Nivel 1 â€“ &lt; 25%</option>
                <option value="2">ğŸŸ¡ Nivel 2 â€“ 25%-50%</option>
                <option value="3">ğŸŸ  Nivel 3 â€“ 50%-75%</option>
                <option value="4">ğŸ”´ Nivel 4 â€“ &gt; 75%</option>
                <option value="?">âšª Desconocido</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="edit-crizopa_adulto">Adulto:</label>
              <select id="edit-crizopa_adulto">
                <option value="0">Sin efecto</option>
                <option value="1">ğŸŸ¢ Nivel 1 â€“ &lt; 25%</option>
                <option value="2">ğŸŸ¡ Nivel 2 â€“ 25%-50%</option>
                <option value="3">ğŸŸ  Nivel 3 â€“ 50%-75%</option>
                <option value="4">ğŸ”´ Nivel 4 â€“ &gt; 75%</option>
                <option value="?">âšª Desconocido</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="edit-crizopa_huevo">Huevo:</label>
              <select id="edit-crizopa_huevo">
                <option value="0">Sin efecto</option>
                <option value="1">ğŸŸ¢ Nivel 1 â€“ &lt; 25%</option>
                <option value="2">ğŸŸ¡ Nivel 2 â€“ 25%-50%</option>
                <option value="3">ğŸŸ  Nivel 3 â€“ 50%-75%</option>
                <option value="4">ğŸ”´ Nivel 4 â€“ &gt; 75%</option>
                <option value="?">âšª Desconocido</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="edit-crizopa_ninfa">Ninfa:</label>
              <select id="edit-crizopa_ninfa">
                <option value="0">Sin efecto</option>
                <option value="1">ğŸŸ¢ Nivel 1 â€“ &lt; 25%</option>
                <option value="2">ğŸŸ¡ Nivel 2 â€“ 25%-50%</option>
                <option value="3">ğŸŸ  Nivel 3 â€“ 50%-75%</option>
                <option value="4">ğŸ”´ Nivel 4 â€“ &gt; 75%</option>
                <option value="?">âšª Desconocido</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="edit-crizopa_persistencia">Persistencia (dÃ­as):</label>
              <input type="text" id="edit-crizopa_persistencia" placeholder="Ej: 3-5 dÃ­as">
            </div>
          </div>
        </div>

        <!-- Aphidius Colemani -->
        <div class="form-section">
          <div class="section-title">Aphidius Colemani</div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="edit-colemani_larva">Larva:</label>
              <select id="edit-colemani_larva">
                <option value="0">Sin efecto</option>
                <option value="1">ğŸŸ¢ Nivel 1 â€“ &lt; 25%</option>
                <option value="2">ğŸŸ¡ Nivel 2 â€“ 25%-50%</option>
                <option value="3">ğŸŸ  Nivel 3 â€“ 50%-75%</option>
                <option value="4">ğŸ”´ Nivel 4 â€“ &gt; 75%</option>
                <option value="?">âšª Desconocido</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="edit-colemani_adulto">Adulto:</label>
              <select id="edit-colemani_adulto">
                <option value="0">Sin efecto</option>
                <option value="1">ğŸŸ¢ Nivel 1 â€“ &lt; 25%</option>
                <option value="2">ğŸŸ¡ Nivel 2 â€“ 25%-50%</option>
                <option value="3">ğŸŸ  Nivel 3 â€“ 50%-75%</option>
                <option value="4">ğŸ”´ Nivel 4 â€“ &gt; 75%</option>
                <option value="?">âšª Desconocido</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="edit-colemani_huevo">Huevo:</label>
              <select id="edit-colemani_huevo">
                <option value="0">Sin efecto</option>
                <option value="1">ğŸŸ¢ Nivel 1 â€“ &lt; 25%</option>
                <option value="2">ğŸŸ¡ Nivel 2 â€“ 25%-50%</option>
                <option value="3">ğŸŸ  Nivel 3 â€“ 50%-75%</option>
                <option value="4">ğŸ”´ Nivel 4 â€“ &gt; 75%</option>
                <option value="?">âšª Desconocido</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="edit-colemani_ninfa">Ninfa:</label>
              <select id="edit-colemani_ninfa">
                <option value="0">Sin efecto</option>
                <option value="1">ğŸŸ¢ Nivel 1 â€“ &lt; 25%</option>
                <option value="2">ğŸŸ¡ Nivel 2 â€“ 25%-50%</option>
                <option value="3">ğŸŸ  Nivel 3 â€“ 50%-75%</option>
                <option value="4">ğŸ”´ Nivel 4 â€“ &gt; 75%</option>
                <option value="?">âšª Desconocido</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="edit-colemani_persistencia">Persistencia (dÃ­as):</label>
              <input type="text" id="edit-colemani_persistencia" placeholder="Ej: 3-5 dÃ­as">
            </div>
          </div>
        </div>

        <!-- Abejorros - VersiÃ³n Simplificada -->
        <div class="form-section">
          <div class="section-title">Abejorros</div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="edit-abejorros_colonia">Colonia:</label>
              <select id="edit-abejorros_colonia">
                <option value="0">Sin efecto</option>
                <option value="1">ğŸŸ¢ Nivel 1 â€“ &lt; 25%</option>
                <option value="2">ğŸŸ¡ Nivel 2 â€“ 25%-50%</option>
                <option value="3">ğŸŸ  Nivel 3 â€“ 50%-75%</option>
                <option value="4">ğŸ”´ Nivel 4 â€“ &gt; 75%</option>
                <option value="?">âšª Desconocido</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="edit-abejorros_persistencia">Persistencia (dÃ­as):</label>
              <input type="text" id="edit-abejorros_persistencia" placeholder="Ej: 3-5 dÃ­as">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>AcciÃ³n recomendada:</label>
              <div class="checkbox-group">
                <label class="checkbox-option">
                  <input type="radio" name="edit-abejorros_accion" value="ninguna" id="edit-abejorros_ninguna"> 
                  âœ… Ninguna acciÃ³n
                </label>
                <label class="checkbox-option">
                  <input type="radio" name="edit-abejorros_accion" value="cubrir" id="edit-abejorros_cubrir"> 
                  ğŸŸ§ Cubrir colmena
                </label>
                <label class="checkbox-option">
                  <input type="radio" name="edit-abejorros_accion" value="retirar" id="edit-abejorros_retirar"> 
                  âŒ Retirar
                </label>
                <label class="checkbox-option">
                  <input type="radio" name="edit-abejorros_accion" value="incompatible" id="edit-abejorros_incompatible"> 
                  âš ï¸ Incompatible
                </label>
              </div>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <button type="submit" class="btn-warning">Actualizar EvaluaciÃ³n</button>
            <button type="button" id="cancel-edit" class="btn-danger">Cancelar</button>
          </div>
        </div>
      </form>
    </div>
    
    <div class="footer">
      <p>Sistema Agroalpha Â© 2025 | Unidad produccion 1</p>
      <p>VersiÃ³n 2.0 - MÃ³dulo de ediciÃ³n</p>
    </div>
  </div>

  <script>
    // ğŸ” ConfiguraciÃ³n Firebase
    const firebaseConfig = {
      databaseURL: "https://agro-productos-default-rtdb.firebaseio.com/"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    // Referencia a la base de datos
    const dbRef = db.ref("daÃ±obeneficos");
    
    // Elementos DOM
    const searchButton = document.getElementById("search-button");
    const searchResults = document.getElementById("search-results");
    const editForm = document.getElementById("edit-form");
    const editFormDaÃ±o = document.getElementById("edit-form-daÃ±o");
    const cancelEdit = document.getElementById("cancel-edit");
    
    // Buscar registros
    searchButton.addEventListener("click", searchRecords);
    
    function searchRecords() {
      const productSearch = document.getElementById("search-product").value.toLowerCase();
      const ingredientSearch = document.getElementById("search-ingredient").value.toLowerCase();
      const categorySearch = document.getElementById("search-category").value;
      
      dbRef.once("value")
        .then((snapshot) => {
          let resultsHTML = "";
          let hasResults = false;
          
          snapshot.forEach((childSnapshot) => {
            const key = childSnapshot.key;
            const data = childSnapshot.val();
            
            // Aplicar filtros
            if (
              (productSearch === "" || data.producto.toLowerCase().includes(productSearch)) &&
              (ingredientSearch === "" || data.ingrediente.toLowerCase().includes(ingredientSearch)) &&
              (categorySearch === "" || data.categoria === categorySearch)
            ) {
              hasResults = true;
              resultsHTML += `
                <tr>
                  <td>${data.categoria}</td>
                  <td>${data.producto}</td>
                  <td>${data.ingrediente}</td>
                  <td>${new Date(data.timestamp).toLocaleDateString()}</td>
                  <td class="action-buttons">
                    <button class="edit-record" data-key="${key}">Editar</button>
                    <button class="delete-record" data-key="${key}">Eliminar</button>
                  </td>
                </tr>
              `;
            }
          });
          
          if (hasResults) {
            searchResults.innerHTML = `
              <table>
                <thead>
                  <tr>
                    <th>CategorÃ­a</th>
                    <th>Producto</th>
                    <th>Ingrediente</th>
                    <th>Fecha</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  ${resultsHTML}
                </tbody>
              </table>
            `;
            
            // Agregar event listeners a los botones de editar y eliminar
            document.querySelectorAll(".edit-record").forEach(button => {
              button.addEventListener("click", function() {
                const key = this.getAttribute("data-key");
                loadRecordForEditing(key);
              });
            });
            
            document.querySelectorAll(".delete-record").forEach(button => {
              button.addEventListener("click", function() {
                const key = this.getAttribute("data-key");
                if (confirm("Â¿EstÃ¡ seguro de que desea eliminar este registro?")) {
                  deleteRecord(key);
                }
              });
            });
            
          } else {
            searchResults.innerHTML = "<p>No se encontraron registros que coincidan con los criterios de bÃºsqueda.</p>";
          }
        })
        .catch((error) => {
          console.error("Error al buscar registros:", error);
          searchResults.innerHTML = "<p>OcurriÃ³ un error al buscar los registros.</p>";
        });
    }
    
    // Cargar registro para ediciÃ³n
    function loadRecordForEditing(key) {
      dbRef.child(key).once("value")
        .then((snapshot) => {
          const data = snapshot.val();
          
          // Guardar la marca de tiempo original
          document.getElementById("edit-key")._originalTimestamp = data.timestamp;
          
          // Llenar el formulario con los datos existentes
          document.getElementById("edit-key").value = key;
          document.getElementById("edit-categoria").value = data.categoria || "";
          document.getElementById("edit-producto").value = data.producto || "";
          document.getElementById("edit-ingrediente").value = data.ingrediente || "";
          
          // A. Swirskii
          document.getElementById("edit-swirskii_larva").value = data.swirskii_larva || "0";
          document.getElementById("edit-swirskii_adulto").value = data.swirskii_adulto || "0";
          document.getElementById("edit-swirskii_huevo").value = data.swirskii_huevo || "0";
          document.getElementById("edit-swirskii_ninfa").value = data.swirskii_ninfa || "0";
          document.getElementById("edit-swirskii_persistencia").value = data.swirskii_persistencia || "";
          
          // N. Cucumeris
          document.getElementById("edit-cucumeris_larva").value = data.cucumeris_larva || "0";
          document.getElementById("edit-cucumeris_adulto").value = data.cucumeris_adulto || "0";
          document.getElementById("edit-cucumeris_huevo").value = data.cucumeris_huevo || "0";
          document.getElementById("edit-cucumeris_ninfa").value = data.cucumeris_ninfa || "0";
          document.getElementById("edit-cucumeris_persistencia").value = data.cucumeris_persistencia || "";
          
          // Crizopa
          document.getElementById("edit-crizopa_larva").value = data.crizopa_larva || "0";
          document.getElementById("edit-crizopa_adulto").value = data.crizopa_adulto || "0";
          document.getElementById("edit-crizopa_huevo").value = data.crizopa_huevo || "0";
          document.getElementById("edit-crizopa_ninfa").value = data.crizopa_ninfa || "0";
          document.getElementById("edit-crizopa_persistencia").value = data.crizopa_persistencia || "";
          
          // Aphidius Colemani
          document.getElementById("edit-colemani_larva").value = data.colemani_larva || "0";
          document.getElementById("edit-colemani_adulto").value = data.colemani_adulto || "0";
          document.getElementById("edit-colemani_huevo").value = data.colemani_huevo || "0";
          document.getElementById("edit-colemani_ninfa").value = data.colemani_ninfa || "0";
          document.getElementById("edit-colemani_persistencia").value = data.colemani_persistencia || "";
          
          // Abejorros
          document.getElementById("edit-abejorros_colonia").value = data.abejorros_colonia || "0";
          document.getElementById("edit-abejorros_persistencia").value = data.abejorros_persistencia || "";
          
          // Seleccionar la opciÃ³n correcta para la acciÃ³n de abejorros
          const abejorrosAccion = data.abejorros_accion || "ninguna";
          document.getElementById(`edit-abejorros_${abejorrosAccion}`).checked = true;
          
          // Mostrar el formulario de ediciÃ³n
          editForm.style.display = "block";
          
          // Desplazarse al formulario de ediciÃ³n
          editForm.scrollIntoView({ behavior: 'smooth' });
        })
        .catch((error) => {
          console.error("Error al cargar el registro:", error);
          alert("OcurriÃ³ un error al cargar el registro para ediciÃ³n.");
        });
    }
    
    // Actualizar registro
    editFormDaÃ±o.addEventListener("submit", function(e) {
      e.preventDefault();
      
      const key = document.getElementById("edit-key").value;
      
      // Obtener la acciÃ³n seleccionada para abejorros
      const abejorrosAccion = document.querySelector('input[name="edit-abejorros_accion"]:checked').value;
      
      const updatedData = {
        // InformaciÃ³n del producto
        categoria: document.getElementById("edit-categoria").value,
        producto: document.getElementById("edit-producto").value,
        ingrediente: document.getElementById("edit-ingrediente").value,
        
        // A. Swirskii
        swirskii_larva: document.getElementById("edit-swirskii_larva").value,
        swirskii_adulto: document.getElementById("edit-swirskii_adulto").value,
        swirskii_huevo: document.getElementById("edit-swirskii_huevo").value,
        swirskii_ninfa: document.getElementById("edit-swirskii_ninfa").value,
        swirskii_persistencia: document.getElementById("edit-swirskii_persistencia").value,
        
        // N. Cucumeris
        cucumeris_larva: document.getElementById("edit-cucumeris_larva").value,
        cucumeris_adulto: document.getElementById("edit-cucumeris_adulto").value,
        cucumeris_huevo: document.getElementById("edit-cucumeris_huevo").value,
        cucumeris_ninfa: document.getElementById("edit-cucumeris_ninfa").value,
        cucumeris_persistencia: document.getElementById("edit-cucumeris_persistencia").value,
        
        // Crizopa
        crizopa_larva: document.getElementById("edit-crizopa_larva").value,
        crizopa_adulto: document.getElementById("edit-crizopa_adulto").value,
        crizopa_huevo: document.getElementById("edit-crizopa_huevo").value,
        crizopa_ninfa: document.getElementById("edit-crizopa_ninfa").value,
        crizopa_persistencia: document.getElementById("edit-crizopa_persistencia").value,
        
        // Aphidius Colemani
        colemani_larva: document.getElementById("edit-colemani_larva").value,
        colemani_adulto: document.getElementById("edit-colemani_adulto").value,
        colemani_huevo: document.getElementById("edit-colemani_huevo").value,
        colemani_ninfa: document.getElementById("edit-colemani_ninfa").value,
        colemani_persistencia: document.getElementById("edit-colemani_persistencia").value,
        
        // Abejorros (versiÃ³n simplificada)
        abejorros_colonia: document.getElementById("edit-abejorros_colonia").value,
        abejorros_persistencia: document.getElementById("edit-abejorros_persistencia").value,
        abejorros_accion: abejorrosAccion,
        
        // Mantener la marca de tiempo original
        timestamp: document.getElementById("edit-key")._originalTimestamp
      };
      
      // Actualizar en Firebase
      dbRef.child(key).update(updatedData)
        .then(() => {
          alert("âœ… Registro actualizado correctamente.");
          editForm.style.display = "none";
          searchRecords(); // Actualizar la lista de resultados
        })
        .catch((error) => {
          console.error("Error al actualizar:", error);
          alert("OcurriÃ³ un error al actualizar el registro.");
        });
    });
    
    // Cancelar ediciÃ³n
    cancelEdit.addEventListener("click", function() {
      editForm.style.display = "none";
    });
    
    // Eliminar registro
    function deleteRecord(key) {
      dbRef.child(key).remove()
        .then(() => {
          alert("âœ… Registro eliminado correctamente.");
          searchRecords(); // Actualizar la lista de resultados
        })
        .catch((error) => {
          console.error("Error al eliminar:", error);
          alert("OcurriÃ³ un error al eliminar el registro.");
        });
    }
    
    // Al cargar la pÃ¡gina, buscar todos los registros
    window.addEventListener("load", searchRecords);
  </script>
</body>
</html>
