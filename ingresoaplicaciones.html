<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Aplicaciones Agrícolas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --primary-color: #2e7d32;
            --secondary-color: #7cb342;
            --accent-color: #ffa000;
            --light-color: #f8f9fa;
            --dark-color: #1b5e20;
            --gray-color: #6c757d;
            --border-radius: 6px;
            --box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --error-color: #dc3545;
            --success-color: #28a745;
            --norte-color: #4fc3f7;
            --sur-color: #ff8a65;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7ff;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            background: linear-gradient(to bottom, #f1f8e9, #e8f5e9);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            border: 1px solid #dee2e6;
        }
        
        header h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        header p {
            color: var(--gray-color);
            font-size: 1.1rem;
        }
        
        .form-container {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid #dee2e6;
        }
        
        .form-title {
            color: var(--dark-color);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-column {
            flex: 1;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ced4da;
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: var(--transition);
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.25);
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .checkbox-item input {
            width: auto;
        }
        
        .capillas-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            border: 1px solid #dee2e6;
        }
        
        .capillas-columns {
            display: flex;
            gap: 20px;
        }
        
        .capillas-col {
            flex: 1;
        }
        
        .capillas-title {
            font-weight: 600;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .norte-title {
            color: var(--norte-color);
        }
        
        .sur-title {
            color: var(--sur-color);
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        button {
            padding: 12px 25px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--dark-color);
        }
        
        .btn-secondary {
            background-color: var(--gray-color);
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transform: translateX(100%);
            opacity: 0;
            transition: var(--transition);
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .notification.success {
            background-color: var(--success-color);
        }
        
        .notification.error {
            background-color: var(--error-color);
        }
        
        .required {
            color: var(--error-color);
        }
        
        .error-message {
            color: var(--error-color);
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        .form-footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
            color: var(--gray-color);
        }
        
        .form-footer a {
            color: var(--primary-color);
            text-decoration: none;
        }
        
        .form-footer a:hover {
            text-decoration: underline;
        }
        
        .info-box {
            padding: 10px 15px;
            background-color: #e8f5e9;
            border-radius: var(--border-radius);
            border: 1px solid #c8e6c9;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .info-box span {
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .fecha-libre-info {
            margin-top: 10px;
            padding: 10px;
            background-color: #e3f2fd;
            border-radius: var(--border-radius);
            border: 1px solid #bbdefb;
        }
        
        .fecha-libre-info p {
            margin: 5px 0;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .capillas-columns {
                flex-direction: column;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-seedling"></i> Registro de Aplicaciones Agrícolas</h1>
            <p>Complete el formulario para registrar una nueva aplicación</p>
        </header>
        
        <div class="form-container">
            <h2 class="form-title"><i class="fas fa-edit"></i> Información de la Aplicación</h2>
            
            <form id="aplicacion-form">
                <div class="form-row">
                    <div class="form-column">
                        <div class="form-group">
                            <label for="cultivo">Cultivo <span class="required">*</span></label>
                            <select id="cultivo" required>
                                <option value="">Seleccione un cultivo</option>
                                <option value="mini">Mini</option>
                                <option value="tomate">Tomate</option>
                            </select>
                            <div class="error-message" id="cultivo-error">Por favor seleccione un cultivo</div>
                        </div>
                    </div>
                    
                    <div class="form-column">
                        <div class="form-group">
                            <label for="invernadero">Invernadero <span class="required">*</span></label>
                            <select id="invernadero" required disabled>
                                <option value="">Primero seleccione un cultivo</option>
                            </select>
                            <div class="error-message" id="invernadero-error">Por favor seleccione un invernadero</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="producto">Producto aplicado <span class="required">*</span></label>
                    <select id="producto" required>
                        <option value="">Seleccione un producto</option>
                        <!-- Los productos se cargarán dinámicamente -->
                    </select>
                    <div class="error-message" id="producto-error">Por favor seleccione un producto</div>
                </div>
                
                <div class="form-row">
                    <div class="form-column">
                        <div class="form-group">
                            <label for="dias-cosecha">Días a cosecha</label>
                            <input type="number" id="dias-cosecha" readonly>
                        </div>
                    </div>
                    
                    <div class="form-column">
                        <div class="form-group">
                            <label for="reingreso">Periodo de reingreso</label>
                            <input type="text" id="reingreso" readonly>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-column">
                        <div class="form-group">
                            <label for="fecha-aplicacion">Fecha de aplicación <span class="required">*</span></label>
                            <input type="date" id="fecha-aplicacion" required>
                            <div class="error-message" id="fecha-aplicacion-error">Por favor seleccione una fecha de aplicación</div>
                        </div>
                    </div>
                    
                    <div class="form-column">
                        <div class="form-group">
                            <label for="hora-aplicacion">Hora de aplicación <span class="required">*</span></label>
                            <input type="time" id="hora-aplicacion" required>
                            <div class="error-message" id="hora-aplicacion-error">Por favor seleccione una hora de aplicación</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="fecha-libre-info">
                        <p><strong>Fecha libre calculada:</strong> <span id="fecha-libre-texto">--/--/----</span></p>
                        <p><strong>Nota:</strong> La fecha libre se calcula considerando el mayor período entre días a cosecha y período de reingreso.</p>
                    </div>
                </div>
                
                <div class="capillas-section">
                    <h3>Capillas aplicadas <span class="required">*</span></h3>
                    <div class="info-box">
                        <p><span>Nota:</span> Cada capilla tiene 8 camas y cada cama 10 módulos. El área total por capilla es de 0.054 ha.</p>
                    </div>
                    
                    <div class="capillas-columns">
                        <div class="capillas-col">
                            <div class="capillas-title norte-title">Norte (1-18)</div>
                            <div class="checkbox-group" id="capillas-norte">
                                <!-- Las capillas norte se cargarán dinámicamente -->
                            </div>
                        </div>
                        
                        <div class="capillas-col">
                            <div class="capillas-title sur-title">Sur (1-18)</div>
                            <div class="checkbox-group" id="capillas-sur">
                                <!-- Las capillas sur se cargarán dinámicamente -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="error-message" id="capillas-error">Por favor seleccione al menos una capilla</div>
                </div>
                
                <div class="form-group">
                    <label for="area">Área aplicada (hectáreas)</label>
                    <input type="number" id="area" step="0.001" readonly>
                    <div class="info-box">
                        <p><span>Cálculo:</span> Área = (Nº de capillas seleccionadas) × 0.054 ha</p>
                    </div>
                </div>
                
                <div class="button-group">
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-save"></i> Guardar Aplicación
                    </button>
                    <button type="button" class="btn-secondary" id="btn-limpiar">
                        <i class="fas fa-broom"></i> Limpiar Formulario
                    </button>
                </div>
            </form>
            
            <div class="form-footer">
                <p>¿Necesita ver las aplicaciones existentes? <a href="visualizador.html">Ir al visualizador</a></p>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification"></div>

    <script>
        // Configuración de Firebase (debe coincidir con la del visualizador)
        const firebaseConfig = {
            databaseURL: "https://agro-productos-default-rtdb.firebaseio.com/"
        };
        
        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Referencias a la base de datos
        const applicationsRef = database.ref('aplicaciones');
        const productsRef = database.ref('productos');
        
        // Definir invernaderos por cultivo (debe coincidir con el visualizador)
        const invernaderos = {
            mini: ["9", "10", "11", "12", "33", "35", "37", "39"],
            tomate: ["13", "14", "15", "16"]
        };
        
        // Lista de productos (se cargará desde Firebase)
        let productos = [];
        
        // Área por capilla (en hectáreas)
        const AREA_POR_CAPILLA = 0.054; // 8 camas × 10 módulos = 0.054 ha

        document.addEventListener('DOMContentLoaded', function() {
            // Cargar eventos y configuraciones iniciales
            configurarEventos();
            configurarFechaHoraActual();
            cargarProductos();
            cargarCapillas();
            
            // Función para cargar productos desde Firebase
            function cargarProductos() {
                productsRef.once('value')
                .then((snapshot) => {
                    const productosData = snapshot.val();
                    const productoSelect = document.getElementById('producto');
                    
                    // Limpiar select
                    productoSelect.innerHTML = '<option value="">Seleccione un producto</option>';
                    
                    if (productosData) {
                        productos = Object.values(productosData);
                        
                        // Agregar productos al select
                        productos.forEach((producto, index) => {
                            const option = document.createElement('option');
                            option.value = index;
                            option.textContent = producto.nombre;
                            productoSelect.appendChild(option);
                        });
                    } else {
                        // Datos de ejemplo si no hay productos en la base de datos
                        productos = [
                            { 
                                nombre: "Fungicida XZ-200", 
                                dias_mini: 3, 
                                dias_tomate: 5,
                                reingreso_mini: "5 días",
                                reingreso_tomate: "7 días"
                            },
                            { 
                                nombre: "Herbicida GreenGrow", 
                                dias_mini: 7, 
                                dias_tomate: 10,
                                reingreso_mini: "10 días",
                                reingreso_tomate: "14 días"
                            },
                            { 
                                nombre: "Insecticida BioProtect", 
                                dias_mini: 1, 
                                dias_tomate: 2,
                                reingreso_mini: "3 días",
                                reingreso_tomate: "5 días"
                            },
                            { 
                                nombre: "Fertilizante CropBoost", 
                                dias_mini: 0, 
                                dias_tomate: 0,
                                reingreso_mini: "1 día",
                                reingreso_tomate: "1 día"
                            }
                        ];
                        
                        productos.forEach((producto, index) => {
                            const option = document.createElement('option');
                            option.value = index;
                            option.textContent = producto.nombre;
                            productoSelect.appendChild(option);
                        });
                    }
                })
                .catch((error) => {
                    console.error("Error loading products:", error);
                    mostrarNotificacion('Error al cargar los productos', 'error');
                });
            }
            
            // Función para cargar las capillas (Norte 1-18, Sur 1-18)
            function cargarCapillas() {
                const capillasNorte = document.getElementById('capillas-norte');
                const capillasSur = document.getElementById('capillas-sur');
                
                // Limpiar contenedores
                capillasNorte.innerHTML = '';
                capillasSur.innerHTML = '';
                
                // Agregar capillas Norte (1-18)
                for (let i = 1; i <= 18; i++) {
                    const capillaDiv = document.createElement('div');
                    capillaDiv.className = 'checkbox-item';
                    capillaDiv.innerHTML = `
                        <input type="checkbox" class="capilla-checkbox" id="capilla-n-${i}" value="N${i}">
                        <label for="capilla-n-${i}">Norte ${i}</label>
                    `;
                    capillasNorte.appendChild(capillaDiv);
                }
                
                // Agregar capillas Sur (1-18)
                for (let i = 1; i <= 18; i++) {
                    const capillaDiv = document.createElement('div');
                    capillaDiv.className = 'checkbox-item';
                    capillaDiv.innerHTML = `
                        <input type="checkbox" class="capilla-checkbox" id="capilla-s-${i}" value="S${i}">
                        <label for="capilla-s-${i}">Sur ${i}</label>
                    `;
                    capillasSur.appendChild(capillaDiv);
                }
                
                // Agregar evento a todas las capillas para calcular el área
                document.querySelectorAll('.capilla-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', calcularArea);
                });
            }
            
            // Función para configurar los eventos del formulario
            function configurarEventos() {
                // Evento para cambiar el cultivo
                document.getElementById('cultivo').addEventListener('change', function() {
                    const cultivo = this.value;
                    const invernaderoSelect = document.getElementById('invernadero');
                    
                    // Limpiar y habilitar el selector de invernadero
                    invernaderoSelect.innerHTML = '';
                    invernaderoSelect.disabled = false;
                    
                    if (cultivo) {
                        // Agregar opción por defecto
                        const defaultOption = document.createElement('option');
                        defaultOption.value = '';
                        defaultOption.textContent = 'Seleccione un invernadero';
                        invernaderoSelect.appendChild(defaultOption);
                        
                        // Agregar invernaderos según el cultivo
                        invernaderos[cultivo].forEach(inv => {
                            const option = document.createElement('option');
                            option.value = inv;
                            option.textContent = `Invernadero ${inv}`;
                            invernaderoSelect.appendChild(option);
                        });
                    } else {
                        invernaderoSelect.disabled = true;
                        invernaderoSelect.innerHTML = '<option value="">Primero seleccione un cultivo</option>';
                    }
                    
                    // Actualizar días a cosecha si hay un producto seleccionado
                    actualizarDatosProducto();
                });
                
                // Evento para cambiar el producto
                document.getElementById('producto').addEventListener('change', function() {
                    actualizarDatosProducto();
                });
                
                // Eventos para actualizar la fecha libre cuando cambien fecha, hora o producto
                document.getElementById('fecha-aplicacion').addEventListener('change', calcularFechaLibre);
                document.getElementById('hora-aplicacion').addEventListener('change', calcularFechaLibre);
                
                // Evento para el formulario
                document.getElementById('aplicacion-form').addEventListener('submit', function(e) {
                    e.preventDefault();
                    guardarAplicacion();
                });
                
                // Evento para el botón limpiar
                document.getElementById('btn-limpiar').addEventListener('click', function() {
                    document.getElementById('aplicacion-form').reset();
                    document.getElementById('invernadero').disabled = true;
                    document.getElementById('invernadero').innerHTML = '<option value="">Primero seleccione un cultivo</option>';
                    document.getElementById('dias-cosecha').value = "";
                    document.getElementById('reingreso').value = "";
                    document.getElementById('area').value = "";
                    document.getElementById('fecha-libre-texto').textContent = "--/--/----";
                    document.querySelectorAll('.capilla-checkbox').forEach(cb => {
                        cb.checked = false;
                    });
                    ocultarErrores();
                    configurarFechaHoraActual();
                });
            }
            
            // Función para actualizar los datos del producto según el cultivo seleccionado
            function actualizarDatosProducto() {
                const cultivo = document.getElementById('cultivo').value;
                const productoIndex = document.getElementById('producto').value;
                
                if (cultivo && productoIndex !== "" && productos[productoIndex]) {
                    const producto = productos[productoIndex];
                    
                    // Obtener días a cosecha según el cultivo
                    const diasCosecha = cultivo === 'mini' ? 
                        producto.dias_mini || 0 : 
                        producto.dias_tomate || 0;
                    
                    // Obtener período de reingreso según el cultivo
                    const reingreso = cultivo === 'mini' ? 
                        producto.reingreso_mini || "" : 
                        producto.reingreso_tomate || "";
                    
                    document.getElementById('dias-cosecha').value = diasCosecha;
                    document.getElementById('reingreso').value = reingreso;
                    
                    // Calcular fecha libre
                    calcularFechaLibre();
                } else {
                    document.getElementById('dias-cosecha').value = "";
                    document.getElementById('reingreso').value = "";
                    document.getElementById('fecha-libre-texto').textContent = "--/--/----";
                }
            }
            
            // Función para calcular la fecha libre
            function calcularFechaLibre() {
                const fechaAplicacion = document.getElementById('fecha-aplicacion').value;
                const horaAplicacion = document.getElementById('hora-aplicacion').value;
                const diasCosecha = parseInt(document.getElementById('dias-cosecha').value) || 0;
                const reingreso = document.getElementById('reingreso').value;
                
                if (fechaAplicacion && horaAplicacion && !isNaN(diasCosecha) && reingreso) {
                    // Extraer el número de días del período de reingreso
                    const diasReentry = parseInt(reingreso) || 0;
                    
                    // Usar el mayor período entre días a cosecha y reingreso
                    const diasTotales = Math.max(diasCosecha, diasReentry);
                    
                    // Calcular fecha libre
                    const fechaLibre = new Date(fechaAplicacion + 'T' + horaAplicacion);
                    fechaLibre.setDate(fechaLibre.getDate() + diasTotales);
                    
                    // Formatear fecha libre para mostrar
                    const fechaLibreFormateada = formatDate(fechaLibre);
                    document.getElementById('fecha-libre-texto').textContent = fechaLibreFormateada;
                } else {
                    document.getElementById('fecha-libre-texto').textContent = "--/--/----";
                }
            }
            
            // Función para calcular el área basada en las capillas seleccionadas
            function calcularArea() {
                const capillasSeleccionadas = document.querySelectorAll('.capilla-checkbox:checked').length;
                const area = capillasSeleccionadas * AREA_POR_CAPILLA;
                document.getElementById('area').value = area.toFixed(3);
            }
            
            // Función para configurar la fecha y hora actual como valores por defecto
            function configurarFechaHoraActual() {
                const hoy = new Date();
                const fechaFormateada = hoy.toISOString().split('T')[0];
                const horaFormateada = hoy.toTimeString().substring(0, 5);
                
                document.getElementById('fecha-aplicacion').value = fechaFormateada;
                document.getElementById('hora-aplicacion').value = horaFormateada;
            }
            
            // Función para guardar la aplicación en Firebase
            function guardarAplicacion() {
                if (validarFormulario()) {
                    // Obtener valores del formulario
                    const cultivo = document.getElementById('cultivo').value;
                    const invernadero = document.getElementById('invernadero').value;
                    const productoIndex = document.getElementById('producto').value;
                    const producto = productos[productoIndex];
                    const fechaAplicacion = document.getElementById('fecha-aplicacion').value;
                    const horaAplicacion = document.getElementById('hora-aplicacion').value;
                    const diasCosecha = document.getElementById('dias-cosecha').value;
                    const reingreso = document.getElementById('reingreso').value;
                    const area = document.getElementById('area').value;
                    
                    // Obtener capillas seleccionadas
                    const capillasSeleccionadas = [];
                    document.querySelectorAll('.capilla-checkbox:checked').forEach(cb => {
                        capillasSeleccionadas.push(cb.value);
                    });
                    
                    // Extraer el número de días del período de reingreso
                    const diasReentry = reingreso ? parseInt(reingreso) : 0;
                    
                    // Usar el mayor período entre días a cosecha y reingreso
                    const diasTotales = Math.max(parseInt(diasCosecha) || 0, diasReentry);
                    
                    // Calcular fecha libre
                    const fechaHoraAplicacion = new Date(fechaAplicacion + 'T' + horaAplicacion);
                    const fechaLibre = new Date(fechaHoraAplicacion);
                    fechaLibre.setDate(fechaLibre.getDate() + diasTotales);
                    const fechaLibreFormateada = formatDate(fechaLibre);
                    
                    // Crear objeto de aplicación
                    const aplicacion = {
                        cultivo,
                        invernadero,
                        area: parseFloat(area),
                        producto: producto.nombre,
                        fechaAplicacion: formatDate(new Date(fechaAplicacion)),
                        horaAplicacion: horaAplicacion,
                        fechaLibre: fechaLibreFormateada,
                        diasReentry: diasTotales,
                        capillasAplicadas: capillasSeleccionadas.join(','),
                        capillasAplicadasArray: capillasSeleccionadas,
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    };
                    
                    // Guardar en Firebase
                    applicationsRef.push(aplicacion)
                        .then(() => {
                            mostrarNotificacion('Aplicación guardada correctamente', 'success');
                            document.getElementById('aplicacion-form').reset();
                            document.getElementById('invernadero').disabled = true;
                            document.getElementById('invernadero').innerHTML = '<option value="">Primero seleccione un cultivo</option>';
                            document.getElementById('dias-cosecha').value = "";
                            document.getElementById('reingreso').value = "";
                            document.getElementById('area').value = "";
                            document.getElementById('fecha-libre-texto').textContent = "--/--/----";
                            document.querySelectorAll('.capilla-checkbox').forEach(cb => {
                                cb.checked = false;
                            });
                            configurarFechaHoraActual();
                        })
                        .catch((error) => {
                            console.error('Error al guardar:', error);
                            mostrarNotificacion('Error al guardar la aplicación', 'error');
                        });
                }
            }
            
            // Función para validar el formulario
            function validarFormulario() {
                let esValido = true;
                ocultarErrores();
                
                // Validar cultivo
                const cultivo = document.getElementById('cultivo').value;
                if (!cultivo) {
                    mostrarError('cultivo-error');
                    esValido = false;
                }
                
                // Validar invernadero
                const invernadero = document.getElementById('invernadero').value;
                if (!invernadero) {
                    mostrarError('invernadero-error');
                    esValido = false;
                }
                
                // Validar producto
                const producto = document.getElementById('producto').value;
                if (!producto) {
                    mostrarError('producto-error');
                    esValido = false;
                }
                
                // Validar fecha de aplicación
                const fechaAplicacion = document.getElementById('fecha-aplicacion').value;
                if (!fechaAplicacion) {
                    mostrarError('fecha-aplicacion-error');
                    esValido = false;
                }
                
                // Validar hora de aplicación
                const horaAplicacion = document.getElementById('hora-aplicacion').value;
                if (!horaAplicacion) {
                    mostrarError('hora-aplicacion-error');
                    esValido = false;
                }
                
                // Validar capillas
                const capillasSeleccionadas = document.querySelectorAll('.capilla-checkbox:checked').length;
                if (capillasSeleccionadas === 0) {
                    mostrarError('capillas-error');
                    esValido = false;
                }
                
                return esValido;
            }
            
            // Función para mostrar error
            function mostrarError(id) {
                document.getElementById(id).style.display = 'block';
            }
            
            // Función para ocultar todos los errores
            function ocultarErrores() {
                const errores = document.querySelectorAll('.error-message');
                errores.forEach(error => {
                    error.style.display = 'none';
                });
            }
            
            // Función para formatear fecha (dd/mm/aaaa)
            function formatDate(date) {
                const day = String(date.getDate()).padStart(2, '0');
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const year = date.getFullYear();
                return `${day}/${month}/${year}`;
            }
            
            // Función para mostrar notificación
            function mostrarNotificacion(mensaje, tipo) {
                const notification = document.getElementById('notification');
                notification.textContent = mensaje;
                notification.className = `notification ${tipo}`;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
        });
    </script>
</body>
</html>
